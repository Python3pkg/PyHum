<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting started &mdash; PyHum 1.3.7 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyHum 1.3.7 documentation" href="index.html" />
    <link rel="next" title="Modules" href="modules.html" />
    <link rel="prev" title="PyHum: Python program for reading and processing low-cost sidescan sonar data" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyHum: Python program for reading and processing low-cost sidescan sonar data"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyHum 1.3.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="about">
<span id="id2"></span><h2>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h2>
<p>PyHum - a Python framework for reading and processing data from a Humminbird low-cost sidescan sonar</p>
<p>PyHum is an open-source project dedicated to provide a generic Python framework
for reading and exporting data from Humminbird(R) instruments, carrying out rudimentary radiometric corrections to the data,
classify bed texture, and produce some maps on aerial photos and kml files for google-earth</p>
<p>The software is designed to read Humminbird data (.SON, .IDX, and .DAT files) and works on both sidescan and downward-looking echosounder data, where available.</p>
<p>Some aspects of the program are detailed in:
Buscombe, D., Grams, P.E., and Smith, S. (2015) &#8220;Automated riverbed sediment classification using low-cost sidescan sonar&#8221;, Journal of Hydraulic Engineering, 10.1061/(ASCE)HY.1943-7900.0001079, 06015019. <a class="reference external" href="http://dbuscombe-usgs.github.io/docs/10-2-2015_Automated%20.pdf">Download here</a></p>
<p>Full documentation of the procedures behind the program is forthcoming in the following publication:
Buscombe, D., submitted, Processing and georeferencing recreational-grade sidescan-sonar data to support the democratization of acoustic imaging in shallow water. LIMNOLOGY AND OCEANOGRAPHY: METHODS.</p>
<p>For the source code visit <a class="reference external" href="https://github.com/dbuscombe-usgs/PyHum/">the project github site</a></p>
<blockquote>
<div><p>Primary Developer |    Daniel Buscombe
&#8212;&#8212; | &#8212;&#8212;&#8212;&#8212;&#8212;</p>
<blockquote>
<div><div class="line-block">
<div class="line">Grand Canyon Monitoring and Research Center
| United States Geological Survey
| Flagstaff, AZ 86001
| <a class="reference external" href="mailto:dbuscombe&#37;&#52;&#48;usgs&#46;gov">dbuscombe<span>&#64;</span>usgs<span>&#46;</span>gov</a></div>
</div>
</div></blockquote>
<p>Co-Developer |    Daniel Hamill
&#8212;&#8212; | &#8212;&#8212;&#8212;&#8212;&#8212;</p>
<blockquote>
<div><div class="line-block">
<div class="line">Department of Watershed Sciences
| Utah State University
| Logan, UT 84322
| <a class="reference external" href="mailto:dhamill&#37;&#52;&#48;usgs&#46;gov">dhamill<span>&#64;</span>usgs<span>&#46;</span>gov</a></div>
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="license">
<span id="id3"></span><h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This software is in the public domain because it contains materials that
originally came from the United States Geological Survey, an agency of the
United States Department of Interior. For more information,
see <a class="reference external" href="http://www.usgs.gov/visual-id/credit_usgs.html#copyright">the official USGS copyright policy</a></p>
<p>Any use of trade, product, or firm names is for descriptive purposes only
and does not imply endorsement by the U.S. government.</p>
<p>This software is issued under the <a class="reference external" href="http://www.gnu.org/copyleft/lesser.html">GNU Lesser General Public License, Version 3</a></p>
<p>Thanks to Barb Fagetter (<a class="reference external" href="mailto:blueseas&#37;&#52;&#48;oceanecology&#46;ca">blueseas<span>&#64;</span>oceanecology<span>&#46;</span>ca</a>) for some format info, Dan Hamill (Utah State University) and Paul Anderson (Quest Geophysical Asia) for debugging and suggestions for improvements</p>
<p>Some aspects of the program are detailed in:
1. Buscombe, D., Grams, P.E., and Smith, S. (2015) &#8220;Automated riverbed sediment classification using low-cost sidescan sonar&#8221;, Journal of Hydraulic Engineering, 10.1061/(ASCE)HY.1943-7900.0001079, 06015019.</p>
<ol class="arabic simple" start="2">
<li>Buscombe, D., submitted, Processing and georeferencing recreational-grade sidescan-sonar data to support the democratization of acoustic imaging in shallow water. LIMNOLOGY AND OCEANOGRAPHY: METHODS.</li>
</ol>
<p>Full documentation of the program is forthcoming</p>
</div>
<div class="section" id="setup-on-anaconda-for-windows">
<span id="setup"></span><h2>Setup on Anaconda for Windows<a class="headerlink" href="#setup-on-anaconda-for-windows" title="Permalink to this headline">¶</a></h2>
<p>PyHum currently has only been tested with Python 2.7, so you&#8217;ll need that version of Anaconda</p>
<p>Step 1. Before installing PyHum, install Basemap using:</p>
<div class="highlight-python"><div class="highlight"><pre>conda install basemap
</pre></div>
</div>
<p>Step 2. Install pyproj. pip seems to have a bug with pyproj depending on what c-compiler your python distribution uses. Therefore, you may have to install pyproj (and other dependencies) from <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyproj">here</a></p>
<ol class="loweralpha simple">
<li>download the .whl file. Choose the file associated with python 2.7 (&#8220;cp27&#8221;) and the architecture you are using, i.e. 32-bit (win32) or 64-bit (amd64)</li>
<li>then move that file to your root Anaconda directory (when you open an Anaconda command prompt it&#8217;s the directory that&#8217;s listed before the prompt &#8216;&gt;&#8217;)</li>
<li>then use pip to install it, e.g.:</li>
</ol>
<blockquote>
<div>pip install pyproj-1.9.4-cp27-none-win_amd64.whl</div></blockquote>
<p>Step 4. Install simplekml, using:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install simplekml
</pre></div>
</div>
<p>Step 3. Assuming a Anaconda distribution which comes with almost all required program dependencies:</p>
<div class="highlight-python"><div class="highlight"><pre>pip uninstall PyHum (removes any previous installation)
pip install PyHum
</pre></div>
</div>
<p>If you get C++ compiler errors (such as &#8220;Unable to find vcvarsall.bat&#8221;), you will need to install the Microsoft Visual C++ compiler from <a class="reference external" href="http://aka.ms/vcpython27">here</a></p>
<p>(Advanced) If you have git installed (from <a class="reference external" href="https://git-scm.com/download/win">here</a>), you can install the latest &#8216;bleeding edge&#8217; (pre-release) version directly from github:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install git+https://github.com/dbuscombe-usgs/PyHum.git
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2>Setup<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Automatic Installation from PyPI:</p>
<div class="highlight-python"><div class="highlight"><pre>pip uninstall PyHum (removes previous installation)
pip install PyHum
</pre></div>
</div>
<p>Automatic Installation from github:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone git@github.com:dbuscombe-usgs/PyHum.git
cd PyHum
python setup.py install
</pre></div>
</div>
<p>or a local installation:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py install --user
</pre></div>
</div>
<p>or with admin privileges, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo python setup.py install
</pre></div>
</div>
<p>This software has been tested with Python 2.7 on
1. Windows 7
2. Linux Fedora (16 &amp; 20)
3. Linux Ubuntu (12.4 &amp; 13.4 &amp; 14.4)</p>
<p>This software has (so far) been used only with Humminbird 798, 898, 998, 1198 and 1199 series instruments.</p>
</div>
<div class="section" id="virtual-environment">
<span id="virtualenv"></span><h2>Virtual environment<a class="headerlink" href="#virtual-environment" title="Permalink to this headline">¶</a></h2>
<p>You could try before you install, using a virtual environment:</p>
<div class="highlight-python"><div class="highlight"><pre>virtualenv venv
source venv/bin/activate
pip install numpy
pip install cython
pip install scipy
pip install joblib
pip install simplekml
pip install pyproj
pip install scikit-learn
pip install Pillow
pip install matplotlib
pip install basemap --allow-external basemap --allow-unverified basemap
pip install pyresample
pip install toolz
pip install dask
pip install pandas
pip install PyHum
python -c &quot;import PyHum; PyHum.test()&quot;
deactivate #(or source venv/bin/deactivate)
</pre></div>
</div>
<p>The results will live in &#8220;venv/lib/python2.7/site-packages/PyHum&#8221;</p>
</div>
<div class="section" id="manual-installation">
<span id="manualinstall"></span><h2>Manual installation<a class="headerlink" href="#manual-installation" title="Permalink to this headline">¶</a></h2>
<p>Python libraries you need to have installed to use PyHum:</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://www.scipy.org/scipylib/download.html">SciPy</a></li>
<li><a class="reference external" href="http://www.scipy.org/scipylib/download.html">Numpy</a></li>
<li><a class="reference external" href="http://pyresample.readthedocs.org/en/latest/index.html#">pyresample</a></li>
<li><a class="reference external" href="http://matplotlib.org/downloads.html">Matplotlib</a></li>
<li><a class="reference external" href="http://cython.org/">cython</a></li>
<li><a class="reference external" href="https://pythonhosted.org/joblib/">joblib</a></li>
<li><a class="reference external" href="http://scikit-learn.org/stable/">Scikit-learn</a></li>
<li><a class="reference external" href="http://www.pythonware.com/products/pil/">Python Image LIbrary (PIL)</a></li>
<li><a class="reference external" href="http://simplekml.readthedocs.org/en/latest/index.html">simplekml</a></li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pyproj">pyproj</a></li>
<li><a class="reference external" href="http://matplotlib.org/basemap/">basemap</a></li>
<li><a class="reference external" href="http://pyresample.readthedocs.org/en/latest/index.html#">pyresample</a></li>
<li><a class="reference external" href="https://toolz.readthedocs.org/en/latest/">toolz</a></li>
<li><a class="reference external" href="http://dask.pydata.org/en/latest/">dask</a></li>
<li><a class="reference external" href="http://pandas.pydata.org/">pandas</a></li>
</ol>
<p>All of the above are available through <a class="reference external" href="https://pypi.python.org/pypi/pip">pip</a> and <a class="reference external" href="https://pythonhosted.org/setuptools/easy_install.html">easy_install</a></p>
</div>
<div class="section" id="installation-on-amazon-linux-ec-2-instance">
<h2>Installation on Amazon Linux EC-2 instance<a class="headerlink" href="#installation-on-amazon-linux-ec-2-instance" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s best to install numpy, scipy, cython and matplotlib through the OS package manager:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo yum install gcc gcc-c++
sudo yum install python27-numpy python27-Cython python27-scipy python27-matplotlib
</pre></div>
</div>
<p>Then install geos libraries using yum and Basemap using pip:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo yum install geos geos-devel geos-python27
sudo pip install basemap --allow-external basemap --allow-unverified basemap
</pre></div>
</div>
<p>Then PyHum using pip (which will install Pillow, pyproj, simplekml, joblib and scikit-learn):</p>
<div class="highlight-python"><div class="highlight"><pre>sudo pip install PyHum
</pre></div>
</div>
</div>
<div class="section" id="test">
<span id="id8"></span><h2>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>A test can be carried out by running the supplied script:</p>
<div class="highlight-python"><div class="highlight"><pre>python -c &quot;import PyHum; PyHum.dotest()&quot;
</pre></div>
</div>
<p>which carries out the following operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># general settings</span>
<span class="n">humfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">),</span><span class="s">&#39;pyhum_test&#39;</span><span class="p">,</span><span class="s">&#39;test.DAT&#39;</span><span class="p">))</span>
<span class="n">sonpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">),</span><span class="s">&#39;pyhum_test&#39;</span><span class="p">))</span>

<span class="n">doplot</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#yes</span>

<span class="c"># reading specific settings</span>
<span class="n">cs2cs_args</span> <span class="o">=</span> <span class="s">&quot;epsg:26949&quot;</span> <span class="c">#arizona central state plane</span>
<span class="n">bedpick</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># auto bed pick</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1450</span> <span class="c"># speed of sound fresh water</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.108</span> <span class="c"># length of transducer</span>
<span class="n">draft</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c"># draft in metres</span>
<span class="n">flip_lr</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># flip port and starboard</span>
<span class="n">model</span> <span class="o">=</span> <span class="mi">998</span> <span class="c"># humminbird model</span>
<span class="n">cog</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># GPS course-over-ground used for heading</span>
<span class="n">calc_bearing</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no</span>
<span class="n">filt_bearing</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no</span>
<span class="n">chunk</span> <span class="o">=</span> <span class="s">&#39;d100&#39;</span> <span class="c"># distance, 100m</span>
<span class="c">#chunk = &#39;p1000&#39; # pings, 1000</span>
<span class="c">#chunk = &#39;h10&#39; # heading deviation, 10 deg</span>

<span class="c"># correction specific settings</span>
<span class="n">maxW</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># rms output wattage</span>
<span class="n">dofilt</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># 1 = apply a phase preserving filter (WARNING!! takes a very long time for large scans)</span>
<span class="n">correct_withwater</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># don&#39;t retain water column in radiometric correction (1 = retains water column for radiomatric corrections)</span>
<span class="n">ph</span> <span class="o">=</span> <span class="mf">7.0</span> <span class="c"># acidity on the pH scale</span>
<span class="n">temp</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c"># water temperature in degrees Celsius</span>
<span class="n">salinity</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c"># for shadow removal</span>
<span class="n">shadowmask</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#automatic shadow removal</span>

<span class="c"># for texture calcs</span>
<span class="n">win</span> <span class="o">=</span> <span class="mi">100</span> <span class="c"># pixel window</span>
<span class="n">shift</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># pixel shift</span>
<span class="n">density</span> <span class="o">=</span><span class="n">win</span><span class="o">/</span><span class="mi">2</span> <span class="c"># win/2</span>
<span class="n">numclasses</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># number of discrete classes for contouring and k-means</span>
<span class="n">maxscale</span> <span class="o">=</span> <span class="mi">20</span> <span class="c"># Max scale as inverse fraction of data length (for wavelet analysis)</span>
<span class="n">notes</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># Notes per octave (for wavelet analysis)</span>

<span class="c"># for mapping</span>
<span class="n">res</span> <span class="o">=</span> <span class="mi">99</span> <span class="c"># grid resolution in metres</span>
<span class="c"># if res==99, the program will automatically calc res from the spatial res of the scans</span>
<span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># gridding mode (simple nearest neighbour)</span>
<span class="c">#mode = 2 # gridding mode (inverse distance weighted nearest neighbour)</span>
<span class="c">#mode = 3 # gridding mode (gaussian weighted nearest neighbour)</span>
<span class="n">dowrite</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#disable writing of point cloud data to file</span>

<span class="n">nn</span> <span class="o">=</span> <span class="mi">64</span> <span class="c">#number of nearest neighbours for gridding (used if mode &gt; 1)</span>
<span class="n">influence</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#Radius of influence used in gridding. Cut off distance in meters</span>
<span class="n">numstdevs</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">#Threshold number of standard deviations in sidescan intensity per grid cell up to which to accept</span>

<span class="c"># for downward-looking echosounder echogram (e1-e2) analysis</span>
<span class="n">beam</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">transfreq</span> <span class="o">=</span> <span class="mf">200.0</span> <span class="c"># frequency (kHz) of downward looking echosounder</span>
<span class="n">integ</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">numclusters</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># number of acoustic classes to group observations</span>

<span class="c">## read data in SON files into PyHum memory mapped format (.dat)</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">draft</span><span class="p">,</span> <span class="n">doplot</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">bedpick</span><span class="p">,</span> <span class="n">flip_lr</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">calc_bearing</span><span class="p">,</span> <span class="n">filt_bearing</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span>

<span class="c">## correct scans and remove water column</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">maxW</span><span class="p">,</span> <span class="n">doplot</span><span class="p">,</span> <span class="n">dofilt</span><span class="p">,</span> <span class="n">correct_withwater</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">salinity</span><span class="p">)</span>

<span class="c">## remove acoustic shadows (caused by distal acoustic attenuation or sound hitting shallows or shoreline)</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">rmshadows</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">shadowmask</span><span class="p">,</span> <span class="n">doplot</span><span class="p">)</span>

<span class="c">## Calculate texture lengthscale maps using the method of Buscombe et al. (2015)</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">texture</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">doplot</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">numclasses</span><span class="p">,</span> <span class="n">maxscale</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>

<span class="c">## grid and map the scans</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">dowrite</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">influence</span><span class="p">,</span> <span class="n">numstdevs</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># grid resolution in metres</span>
<span class="n">numstdevs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c">## grid and map the texture lengthscale maps</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">map_texture</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">influence</span><span class="p">,</span> <span class="n">numstdevs</span><span class="p">)</span>

<span class="c">## calculate and map the e1 and e2 acoustic coefficients from the downward-looking sonar</span>
<span class="n">PyHum</span><span class="o">.</span><span class="n">e1e2</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">salinity</span><span class="p">,</span> <span class="n">beam</span><span class="p">,</span> <span class="n">transfreq</span><span class="p">,</span> <span class="n">integ</span><span class="p">,</span> <span class="n">numclusters</span><span class="p">,</span> <span class="n">doplot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gettingstarted">
<span id="id9"></span><h2>Getting Started<a class="headerlink" href="#gettingstarted" title="Permalink to this headline">¶</a></h2>
<p>Inputs to the program are a .DAT file (e.g. R0089.DAT) and a folder of .SON and .IDX files (e.g. /my/folder/R0089). The program will read the .SON files with or without the accompanying .IDX files, but will be faster if the .IDX files are present.</p>
<p>PyHum is modular so can be called from within a python or ipython console, from an IDE (such as IDLE or Spyder), or by running a script.</p>
<p>The following example script:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">getopt</span>

<span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="n">Tk</span>
<span class="kn">from</span> <span class="nn">tkFileDialog</span> <span class="kn">import</span> <span class="n">askopenfilename</span><span class="p">,</span> <span class="n">askdirectory</span>

<span class="kn">import</span> <span class="nn">PyHum</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">humfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span> <span class="n">sonpath</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># parse inputs to variables</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span><span class="s">&quot;hi:s:&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">GetoptError</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&#39;error&#39;</span>
         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="s">&#39;-h&#39;</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&#39;help&#39;</span>
         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
       <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">):</span>
          <span class="n">humfile</span> <span class="o">=</span> <span class="n">arg</span>
       <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-s&quot;</span><span class="p">):</span>
          <span class="n">sonpath</span> <span class="o">=</span> <span class="n">arg</span>

    <span class="c"># prompt user to supply file if no input file given</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">humfile</span><span class="p">:</span>
       <span class="k">print</span> <span class="s">&#39;An input file is required!!!!!!&#39;</span>
       <span class="n">Tk</span><span class="p">()</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c"># we don&#39;t want a full GUI, so keep the root window from appearing</span>
       <span class="n">humfile</span> <span class="o">=</span> <span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;DAT files&quot;</span><span class="p">,</span><span class="s">&quot;*.DAT&quot;</span><span class="p">)])</span>

    <span class="c"># prompt user to supply directory if no input sonpath is given</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sonpath</span><span class="p">:</span>
       <span class="k">print</span> <span class="s">&#39;A *.SON directory is required!!!!!!&#39;</span>
       <span class="n">Tk</span><span class="p">()</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c"># we don&#39;t want a full GUI, so keep the root window from appearing</span>
       <span class="n">sonpath</span> <span class="o">=</span> <span class="n">askdirectory</span><span class="p">()</span>

    <span class="c"># print given arguments to screen and convert data type where necessary</span>
    <span class="k">if</span> <span class="n">humfile</span><span class="p">:</span>
       <span class="k">print</span> <span class="s">&#39;Input file is </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">humfile</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sonpath</span><span class="p">:</span>
       <span class="k">print</span> <span class="s">&#39;Son files are in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sonpath</span><span class="p">)</span>

    <span class="c"># general settings</span>
    <span class="n">doplot</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#yes</span>

    <span class="c"># reading specific settings</span>
    <span class="n">cs2cs_args</span> <span class="o">=</span> <span class="s">&quot;epsg:32100&quot;</span> <span class="c">#NAD83 / Montana</span>
    <span class="n">bedpick</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># manual bed pick</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">1450</span> <span class="c"># speed of sound fresh water</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.108</span> <span class="c"># length of transducer</span>
    <span class="n">draft</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c"># draft in metres</span>
    <span class="n">flip_lr</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># flip port and starboard</span>
    <span class="n">model</span> <span class="o">=</span> <span class="mi">1199</span> <span class="c"># humminbird model</span>
    <span class="n">dowrite</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#disable writing of point cloud data to file</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="s">&#39;d100&#39;</span> <span class="c"># distance, 100m</span>
    <span class="c">#chunk = &#39;p1000&#39; # pings, 1000</span>
    <span class="c">#chunk = &#39;h10&#39; # heading deviation, 10 deg</span>

    <span class="c"># correction specific settings</span>
    <span class="n">maxW</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># rms output wattage</span>
    <span class="n">dofilt</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># apply a phase preserving filter (WARNING!! takes a very long time for large scans)</span>
    <span class="n">correct_withwater</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># don&#39;t retain water column in radiometric correction (1 = retains water column for radiomatric corrections)</span>

    <span class="c"># for shadow removal</span>
    <span class="n">shadowmask</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#manual shadow removal</span>
    <span class="n">win</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="c"># for mapping</span>
    <span class="n">dogrid</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># yes</span>
    <span class="n">calc_bearing</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no</span>
    <span class="n">filt_bearing</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c"># grid resolution in metres</span>
    <span class="n">cog</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># GPS course-over-ground used for heading</span>

    <span class="n">PyHum</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">draft</span><span class="p">,</span> <span class="n">doplot</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">bedpick</span><span class="p">,</span> <span class="n">flip_lr</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

    <span class="n">PyHum</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">maxW</span><span class="p">,</span> <span class="n">doplot</span><span class="p">,</span> <span class="n">dofilt</span><span class="p">,</span> <span class="n">correct_withwater</span><span class="p">)</span>

    <span class="n">PyHum</span><span class="o">.</span><span class="n">rmshadows</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">shadowmask</span><span class="p">,</span> <span class="n">doplot</span><span class="p">)</span>

    <span class="n">PyHum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">humfile</span><span class="p">,</span> <span class="n">sonpath</span><span class="p">,</span> <span class="n">cs2cs_args</span><span class="p">,</span> <span class="n">calc_bearing</span><span class="p">,</span> <span class="n">filt_bearing</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">dowrite</span><span class="p">)</span>
</pre></div>
</div>
<p>could be saved as, for example &#8220;proc_mysidescandata.py&#8221; and run from the command line using:</p>
<div class="highlight-python"><div class="highlight"><pre>python proc_mysidescandata.py -i C:\MyData\R0087.DAT -s C:\MyData\R0087
</pre></div>
</div>
<p>or from within ipython (with a GUI prompt to navigate to the files):</p>
<div class="highlight-python"><div class="highlight"><pre>%run proc_mysidescandata.py
</pre></div>
</div>
<p>If you are in bash (or git bash) you might want to automate through a folder of subfolders like this:</p>
<div class="highlight-python"><div class="highlight"><pre>for k in $(find $PWD -type d -maxdepth 1 -mindepth 1); do python proc_mysidescandata.py -i &quot;$k/${k##*/}.DAT&quot; -s $k; done
</pre></div>
</div>
<p>which assumes the .DAT file is in the folder with the same root (such as a folder called R00123 which contains SON and IDX files as well as a file called R00123.DAT)</p>
</div>
<div class="section" id="support">
<span id="id10"></span><h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>This is a new project written and maintained by Daniel Buscombe. Bugs are expected - please report them, I will fix them quickly. Feedback and suggestions for improvements are <em>very</em> welcome</p>
<p>Please download, try, report bugs, fork, modify, evaluate, discuss, collaborate. Please use the &#8216;Issues&#8217; tab in github <a class="reference external" href="https://github.com/dbuscombe-usgs/PyHum">here</a></p>
<p>Thanks for stopping by!</p>
</div>
<div class="section" id="trouble-shooting">
<span id="troubleshooting"></span><h2>Trouble Shooting<a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h2>
<p>1. Problem: pyhum read hangs for a long time (several minutes) on the test script.
Try this: uninstall joblib and install an older version:</p>
<div class="highlight-python"><div class="highlight"><pre>pip uninstall joblib
pip install joblib==0.7.1
</pre></div>
</div>
<p>2. Problem: you get an &#8220;invalid mode or file name&#8221; error.
Try this: construct file paths using raw strings e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">r&#39;C:\Users\me\mydata\R0089&#39;</span>
</pre></div>
</div>
<p>or using os, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;C:\Users&#39;</span><span class="p">,</span><span class="s">&#39;me&#39;</span><span class="p">,</span><span class="s">&#39;mydata&#39;</span><span class="p">,</span><span class="s">&#39;R0089&#39;</span><span class="p">))</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">Problem: on Linux, PyHum is using an older version of scipy than 0.16, as revealed by:</p>
<p>python -c &#8216;import scipy;print(scipy.__version__)&#8217;</p>
</li>
</ol>
<p>Try this: remove a system installed file e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get remove python-scipy ##(Debian based)
yum remove scipy ##(Fedora based)
</pre></div>
</div>
<ol class="arabic" start="4">
<li><p class="first">Problem: do I have the latest version of PyHum installed? Check your version using this:</p>
<p>python -c &#8216;import PyHum;print(PyHum.__version__)&#8217;</p>
</li>
</ol>
<p>Check this against the latest <a class="reference external" href="https://github.com/dbuscombe-usgs/PyHum/blob/master/PyHum/__init__.py">bleeding-edge&#8217; version `here</a> (line 47)</p>
<img alt="_images/pyhum_logo_colour_sm.png" src="_images/pyhum_logo_colour_sm.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/pyhum_logo_white.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting started</a><ul>
<li><a class="reference internal" href="#about">About</a></li>
<li><a class="reference internal" href="#license">License</a></li>
<li><a class="reference internal" href="#setup-on-anaconda-for-windows">Setup on Anaconda for Windows</a></li>
<li><a class="reference internal" href="#id6">Setup</a></li>
<li><a class="reference internal" href="#virtual-environment">Virtual environment</a></li>
<li><a class="reference internal" href="#manual-installation">Manual installation</a></li>
<li><a class="reference internal" href="#installation-on-amazon-linux-ec-2-instance">Installation on Amazon Linux EC-2 instance</a></li>
<li><a class="reference internal" href="#test">Test</a></li>
<li><a class="reference internal" href="#gettingstarted">Getting Started</a></li>
<li><a class="reference internal" href="#support">Support</a></li>
<li><a class="reference internal" href="#trouble-shooting">Trouble Shooting</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">PyHum: Python program for reading and processing low-cost sidescan sonar data</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modules.html"
                        title="next chapter">Modules</a></p>

    <hr/>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <hr/>
    <div>
	<h3>Mailing list</h3>
	<a href="https://github.com/dbuscombe-usgs/PyHum/">dbuscombe@usgs.gov</a>
    <p class="searchtip" style="font-size: 80%">
    Send an email to subscribe</p>
    </div>
<hr/>
<small><a href="_sources/README.txt"
           rel="nofollow">Show this page source</a>
</small>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modules.html" title="Modules"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyHum: Python program for reading and processing low-cost sidescan sonar data"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyHum 1.3.7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Daniel Buscombe.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>